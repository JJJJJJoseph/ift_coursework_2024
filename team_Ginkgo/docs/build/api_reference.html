<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>API Reference &#8212; CSR Data Pipeline 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=f2a433a1"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Architecture Overview" href="architecture.html" />
    <link rel="prev" title="Usage Guide" href="usage.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="api-reference">
<h1>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading">¶</a></h1>
<p>This section provides detailed API documentation.</p>
<section id="module-modules.database">
<span id="database-module"></span><h2>Database Module<a class="headerlink" href="#module-modules.database" title="Link to this heading">¶</a></h2>
<p>This script creates a table in the database to store the companies and their CSR reports.
It first establishes a connection to the database using the psycopg2 library and the database configuration settings.
It then creates a schema named “Ginkgo” if it does not already exist.
Next, it creates a table named “csr_reports” with columns for the company symbol, company name, report year, report URL, and Minio path.
After creating the table, it selects all companies from the “company_static” table and inserts each company starting from the year 2014 into the “csr_reports” table.
The script uses the “ON CONFLICT DO nothing” clause to avoid inserting duplicate records.
Finally, it commits the changes and closes the database connection.
The script prints a success message after successfully inserting the companies into the “csr_reports” table.</p>
<dl class="py function">
<dt class="sig sig-object py" id="modules.database.insert_companies">
<span class="sig-prename descclassname"><span class="pre">modules.database.</span></span><span class="sig-name descname"><span class="pre">insert_companies</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/database.html#insert_companies"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.database.insert_companies" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-modules.scraper">
<span id="scraper-module"></span><h2>Scraper Module<a class="headerlink" href="#module-modules.scraper" title="Link to this heading">¶</a></h2>
<p>This script is used to scrape the PDF report URLs for the companies in the database.
It uses the Google Custom Search API to search for the company’s CSR report for a specific year.
The script first establishes a connection to the database using the psycopg2 library and the database configuration settings.
It then queries the database to get the list of companies that do not have a report URL.
Next, it defines a function to search for the PDF report URL using the Google Custom Search API.
The function makes up to 3 attempts to find the PDF report URL for the given company and year.
If the PDF report URL is found, it returns the URL; otherwise, it returns None.
The script then defines a function to update the database with the PDF report URL for the given company and year.
The function calls the search function to get the PDF report URL and updates the database with the URL.
Finally, the script uses multithreading to scrape the PDF report URLs for multiple companies concurrently.
It creates a thread pool executor with a maximum number of threads and maps the companies to the process function to scrape the PDF report URLs.
The script prints the status of each company’s PDF report URL scraping and the total time taken for the process.</p>
<dl class="py function">
<dt class="sig sig-object py" id="modules.scraper.get_companies_to_scrape">
<span class="sig-prename descclassname"><span class="pre">modules.scraper.</span></span><span class="sig-name descname"><span class="pre">get_companies_to_scrape</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/scraper.html#get_companies_to_scrape"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.scraper.get_companies_to_scrape" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.scraper.get_db_connection">
<span class="sig-prename descclassname"><span class="pre">modules.scraper.</span></span><span class="sig-name descname"><span class="pre">get_db_connection</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/scraper.html#get_db_connection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.scraper.get_db_connection" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.scraper.google_search_pdf">
<span class="sig-prename descclassname"><span class="pre">modules.scraper.</span></span><span class="sig-name descname"><span class="pre">google_search_pdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">company_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/scraper.html#google_search_pdf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.scraper.google_search_pdf" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.scraper.multithread_update_csr_reports">
<span class="sig-prename descclassname"><span class="pre">modules.scraper.</span></span><span class="sig-name descname"><span class="pre">multithread_update_csr_reports</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/scraper.html#multithread_update_csr_reports"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.scraper.multithread_update_csr_reports" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.scraper.process_company_data">
<span class="sig-prename descclassname"><span class="pre">modules.scraper.</span></span><span class="sig-name descname"><span class="pre">process_company_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">company_data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/scraper.html#process_company_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.scraper.process_company_data" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-modules.minio_client">
<span id="minio-storage-module"></span><h2>MinIO Storage Module<a class="headerlink" href="#module-modules.minio_client" title="Link to this heading">¶</a></h2>
<p>MinIO Client Module</p>
<p>This module handles PDF document management with MinIO object storage. It provides functionality to:
- Download PDFs from URLs using both requests and Selenium
- Upload PDFs to MinIO storage
- Update database records with MinIO paths
- Process multiple PDFs concurrently</p>
<p>The module uses MinIO Python SDK for object storage operations, psycopg2 for database
interactions, and both requests and Selenium for PDF downloads.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="modules.minio_client.BASE_TEMP_DIR">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">BASE_TEMP_DIR</span></span><a class="headerlink" href="#modules.minio_client.BASE_TEMP_DIR" title="Link to this definition">¶</a></dt>
<dd><p>Base temporary directory for storing downloaded PDFs</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="modules.minio_client.minio_client">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">minio_client</span></span><a class="headerlink" href="#modules.minio_client.minio_client" title="Link to this definition">¶</a></dt>
<dd><p>Global MinIO client instance</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Minio</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="modules.minio_client.global_driver">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">global_driver</span></span><a class="headerlink" href="#modules.minio_client.global_driver" title="Link to this definition">¶</a></dt>
<dd><p>Global Selenium WebDriver instance</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>webdriver.Chrome</p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">minio_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">multithread_process_pdfs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">multithread_process_pdfs</span><span class="p">()</span>  <span class="c1"># Process all pending PDFs</span>
</pre></div>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="modules.minio_client.close_driver">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">close_driver</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/minio_client.html#close_driver"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.minio_client.close_driver" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.minio_client.download_pdf">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">download_pdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/minio_client.html#download_pdf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.minio_client.download_pdf" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.minio_client.get_db_connection">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">get_db_connection</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/minio_client.html#get_db_connection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.minio_client.get_db_connection" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.minio_client.get_pdfs_to_download">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">get_pdfs_to_download</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/minio_client.html#get_pdfs_to_download"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.minio_client.get_pdfs_to_download" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.minio_client.multithread_process_pdfs">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">multithread_process_pdfs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/minio_client.html#multithread_process_pdfs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.minio_client.multithread_process_pdfs" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.minio_client.process_pdf">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">process_pdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">report_data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/minio_client.html#process_pdf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.minio_client.process_pdf" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.minio_client.selenium_download_pdf">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">selenium_download_pdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/minio_client.html#selenium_download_pdf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.minio_client.selenium_download_pdf" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.minio_client.update_minio_path">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">update_minio_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minio_path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/minio_client.html#update_minio_path"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.minio_client.update_minio_path" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.minio_client.upload_to_minio">
<span class="sig-prename descclassname"><span class="pre">modules.minio_client.</span></span><span class="sig-name descname"><span class="pre">upload_to_minio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">local_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bucket_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/minio_client.html#upload_to_minio"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.minio_client.upload_to_minio" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-modules.scheduler">
<span id="task-scheduler"></span><h2>Task Scheduler<a class="headerlink" href="#module-modules.scheduler" title="Link to this heading">¶</a></h2>
<p>This script is used to schedule the running of the database, scraper, and minio_client scripts.
The scripts are run every quarter (Jan 1st, Apr 1st, Jul 1st, Oct 1st) at 00:00.
The script uses the apscheduler library to schedule the tasks in the background.
The run_script function is used to run a specific script, and the run_all_scripts function is used to run all the scripts.
The start_scheduled_tasks function is used to start the background scheduler.
The script is run as the main module to start the scheduled tasks.</p>
<dl class="py function">
<dt class="sig sig-object py" id="modules.scheduler.run_all_scripts">
<span class="sig-prename descclassname"><span class="pre">modules.scheduler.</span></span><span class="sig-name descname"><span class="pre">run_all_scripts</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/scheduler.html#run_all_scripts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.scheduler.run_all_scripts" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.scheduler.run_script">
<span class="sig-prename descclassname"><span class="pre">modules.scheduler.</span></span><span class="sig-name descname"><span class="pre">run_script</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">script_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/scheduler.html#run_script"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.scheduler.run_script" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="modules.scheduler.start_scheduled_tasks">
<span class="sig-prename descclassname"><span class="pre">modules.scheduler.</span></span><span class="sig-name descname"><span class="pre">start_scheduled_tasks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/modules/scheduler.html#start_scheduled_tasks"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#modules.scheduler.start_scheduled_tasks" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">CSR Data Pipeline</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-modules.database">Database Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-modules.scraper">Scraper Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-modules.minio_client">MinIO Storage Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-modules.scheduler">Task Scheduler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture Overview</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="usage.html" title="previous chapter">Usage Guide</a></li>
      <li>Next: <a href="architecture.html" title="next chapter">Architecture Overview</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Team Ginkgo.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.1</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/api_reference.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>